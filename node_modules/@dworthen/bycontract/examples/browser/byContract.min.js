!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("lib",[],e):"object"==typeof exports?exports.lib=e():t.lib=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n extends TypeError{constructor(t,e){super(e),this.code=t,this.name="ByContractError",this.message=e,Object.setPrototypeOf(this,n.prototype)}toString(){return"ByContractError: "+this.message}}e.default=n},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n={arguments:t=>"[object Arguments]"===toString.call(t),array:Array.isArray||function(t){return"[object Array]"===toString.call(t)},string:t=>"[object String]"===toString.call(t),undefined:t=>void 0===t,boolean:t=>!0===t||!1===t||"[object Boolean]"===toString.call(t),function:t=>"[object Function]"===toString.call(t)||"function"==typeof t,nan:t=>t!=t,null:t=>null===t,number:t=>!n.nan(t)&&"[object Number]"===toString.call(t),regexp:t=>"[object RegExp]"===toString.call(t),object:t=>{const e=typeof t;return"function"===e||"object"===e&&!!t}};e.default=n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(4)),a=r(6),o=n(r(7));function s(t,...r){return i.default.options.enable?(t.map(t=>t.trim().replace(/[\r\n]/,"")).filter(t=>t.length).forEach((t,n)=>{const{contract:i}=a.parse(t);if(!(i&&n in r))throw new e.Exception("EINVALIDJSODC","invalid JSDOC. Expected syntax::\n  @param {string|number} ${ foo }\n  @param {number} ${ bar }\n         ");try{e.validate(r[n],i)}catch(t){throw new e.Exception(t.code,`Argument #${n}: `+t.message)}}),"ignore"):"ignore"}function c(t){return function(r,n,o){const s=o.value,{params:c,returns:u}=a.validateJsDocString(t);return i.default.options.enable?Object.assign({},o,{value:function(){const t=Array.from(arguments);c.forEach((r,i)=>{try{e.validate(t[i],r.contract)}catch(t){throw new e.Exception(t.code,`Method: ${n}, parameter ${r.name}: `+t.message)}});let r=s.apply(this,t);try{u&&e.validate(r,u.contract)}catch(t){throw new e.Exception(t.code,`Method: ${n}, return value: `+t.message)}return r}}):o}}e.validate=i.default.validate,e.Exception=i.default.Exception,e.typedef=i.default.typedef,e.config=i.default.config,e.validateContract=s,e.validateJsdoc=c,o.default.byContract=Object.assign({},i.default,{validateJsdoc:c,validateContract:s})},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(0)),a=n(r(5)),o=n(r(2)),s={};function c(t,e,r){return`${e?e+": ":""}${void 0!==r?`Argument #${r}: `:""}${t}`}function u(t,e,r){if(!f.options.enable)return t;if(void 0===e)throw new i.default("EINVALIDPARAM",c("Invalid parameters. The second parameter (contracts) is missing",r));if(o.default.array(e)){if(o.default.arguments(t)&&(t=Array.from(t)),!o.default.array(t))throw new i.default("EINVALIDPARAM",c("Invalid parameters. When the second parameter (contracts) is an array, the first parameter (values) must an array too",r));return e.forEach((e,n)=>{if(!(n in t))throw new i.default("EMISSINGARG",c("Missing required agument",r));l(t[n],e,r,n)}),t}return l(t,e,r),t}function l(t,e,r,n){try{if(e in s)return a.default(t,s[e]);a.default(t,e)}catch(t){if(!(t instanceof i.default))throw t;throw new i.default(t.code,c(t.message,r,n))}}const f={options:{enable:!0},Exception:i.default,validate:u,typedef:function(t,e){if(u([t,e],["string","*"],"byContract.typedef"),t in o.default)throw new i.default("EINVALIDPARAM","Custom type must not override a primitive");s[t]=e},config:function(t){f.options=Object.assign({},f.options,t)}};e.default=f},function(t,e,r){"use strict";(function(t){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(0)),a=n(r(2)),o="undefined"!=typeof window?window:t;function s(t){return"object"==typeof t&&"constructor"in t&&t.constructor.name?`instance of ${t.constructor.name}`:"function"==typeof t?t.prototype.constructor.name:c(t)}function c(t){return Object.keys(a.default).find(e=>a.default[e](t))||typeof t}function u(t,e,r=""){new f(t,e,r).validate()}function l(t,e){return e?e+"."+t:t}e.default=u;class f{constructor(t,e,r=""){this.val=t,this.contract=e,this.propPath=r}validate(){if(!this.assertAny()&&!this.assertObject()&&!this.assertInterface()){if(!a.default.string(this.contract))throw this.newException("EINVALIDCONTRACT","invalid parameters. Contract must be a string or a constructor function");if(!(this.assertOptional()||this.assertBasicType()||this.assertNullable()||this.assertNonNullable())){if(this.assertUnion())return!0;if(this.assertStrictArrayJson())return!0;if(!this.assertStrictArray()&&!this.assertStrictObject()){if(!this.contract.match(/^[a-zA-Z0-9\._]+$/))throw this.newException("EINVALIDCONTRACT",`invalid contract ${JSON.stringify(this.contract)}`);if(!this.assertGlobal())throw this.newException("EINVALIDCONTRACT",`invalid contract ${JSON.stringify(this.contract)}`)}}}}assertGlobal(){if(!(this.contract in o)||"function"!=typeof o[this.contract])return!1;if(this.val instanceof o[this.contract])return!0;throw this.newException("EINTERFACEVIOLATION",`expected instance of ${o[this.contract]} but got ${s(this.val)}`)}assertAny(){return!(!a.default.string(this.contract)||"*"!==this.contract)}assertObject(){if(!this.contract||"object"!=typeof this.contract)return!1;if(!this.val||"object"!=typeof this.val)throw this.newException("EINVALIDTYPE",`expected object literal but got ${c(this.val)}`);return Object.keys(this.contract).forEach((t,e)=>{const r=this.contract[t];if(!(t in this.val||function(t){return a.default.string(t)&&t.endsWith("=")}(r)))throw this.newException("EMISSINGPROP","missing required property #"+l(t,this.propPath));u(this.val[t],r,l(t,this.propPath))}),!0}assertInterface(){if(!a.default.function(this.contract)&&"object"!=typeof this.contract)return!1;if(!(this.val instanceof this.contract))throw this.newException("EINTERFACEVIOLATION",`expected instance of ${s(this.contract)} but got ${s(this.val)}`);return!0}assertOptional(){if(this.contract.match(/=$/)){if(!this.val)return!0;this.contract=this.contract.substr(0,this.contract.length-1)}return!1}assertBasicType(){const t=this.contract.toLowerCase(),e=a.default[t];if(void 0===e)return!1;if(!e(this.val))throw this.newException("EINVALIDTYPE",`expected ${t} but got ${c(this.val)}`);return!0}assertNullable(){if("?number"!==this.contract)return!1;if(a.default.number(this.val)||a.default.null(this.val))return!0;throw this.newException("EINVALIDTYPE",`expected nullable but got ${c(this.val)}`)}assertNonNullable(){if("!number"!==this.contract)return!1;if(a.default.number(this.val)&&!a.default.null(this.val))return!0;throw this.newException("EINVALIDTYPE",`expected non-nullable but got ${c(this.val)}`)}assertUnion(){if(!this.contract.includes("|"))return!1;let t=[];if(!this.contract.split("|").some(e=>(function(t,e,r=[]){try{return u(t,e),!0}catch(t){if(!(t instanceof i.default))throw t;return r.push(t.message),!1}})(this.val,e,t))){const e=a.default.array(this.val)||a.default.object(this.val)?"failed on each: "+t.join(", "):"got "+c(this.val);throw this.newException("EINVALIDTYPE",`expected ${this.contract} but ${e}`)}return!0}assertStrictArrayJson(){if(!this.contract.endsWith("[]"))return!1;const t=this.contract.replace(/\[\]$/,"");let e=0;if("*"===t)return this.contract="array",this.assertBasicType();try{a.default.array(this.val)&&this.val.forEach(r=>{u(r,t),e++})}catch(t){throw this.newException("EINVALIDTYPE",`array element ${e}: ${t.message}`)}return!0}assertStrictArray(){if(!this.contract.startsWith("Array.<"))return!1;let t=0;const e=this.contract.match(/Array\.<(.+)>/i);if(!e)throw this.newException("EINVALIDCONTRACT",`invalid contract ${s(this.contract)}`);if("*"===e[1])return this.contract="array",this.assertBasicType();try{a.default.array(this.val)&&this.val.forEach(r=>{u(r,e[1]),t++})}catch(e){throw this.newException("EINVALIDTYPE",`array element ${t}: ${e.message}`)}return!0}assertStrictObject(){if(0!==this.contract.indexOf("Object.<"))return!1;let t=null;const e=this.contract.match(/Object\.<(.+),\s*(.+)>/i);if(!e)throw this.newException("EINVALIDCONTRACT",`invalid contract ${s(this.contract)}`);if("*"===e[2])return this.contract="object",this.assertBasicType();try{a.default.object(this.val)&&Object.keys(this.val).forEach(r=>{t=r,u(this.val[r],e[2])})}catch(e){throw this.newException("EINVALIDTYPE",`object property ${t}: ${e.message}`)}return!0}newException(t,e){const r=this.propPath?` property #${this.propPath} `:"";return new i.default(t,r+e)}}}).call(this,r(1))},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(0));function a(t){const e=t.indexOf("{"),r=t.indexOf("}");if(-1===e||-1===r)throw new i.default("EINVALIDJSDOC","invalid JSDOC. Expected syntax: { exp } param");return{contract:t.substr(e+1,r-e-1),name:t.substr(r+1).trim()}}e.parse=a,e.validateJsDocString=function(t){let e=[],r=null;return t.split("\n").map(t=>t.trim().replace(/\r/,"")).filter(t=>t.length).forEach(t=>{switch(!0){case t.startsWith("@param"):e.push(a(t));break;case t.startsWith("@returns"):r=a(t);break;default:throw new i.default("EINVALIDJSDOC","only @param and @returns tags allowed")}}),{params:e,returns:r}}},function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r="undefined"!=typeof window?window:t;e.default=r}).call(this,r(1))}])});