!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("lib",[],e):"object"==typeof exports?exports.lib=e():t.lib=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";var n,a=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(r,n){var a=t.call(this,n)||this;return a.code=r,a.name="ByContractError",a.message=n,Object.setPrototypeOf(a,e.prototype),a}return a(e,t),e.prototype.toString=function(){return"ByContractError: "+this.message},e}(TypeError);e.default=o},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={arguments:function(t){return"[object Arguments]"===toString.call(t)},array:Array.isArray||function(t){return"[object Array]"===toString.call(t)},string:function(t){return"[object String]"===toString.call(t)},undefined:function(t){return void 0===t},boolean:function(t){return!0===t||!1===t||"[object Boolean]"===toString.call(t)},function:function(t){return"[object Function]"===toString.call(t)||"function"==typeof t},nan:function(t){return t!=t},null:function(t){return null===t},number:function(t){return!n.nan(t)&&"[object Number]"===toString.call(t)},regexp:function(t){return"[object RegExp]"===toString.call(t)},object:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t}};e.default=n},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=a(r(4)),i=r(6),c=a(r(7));function s(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return o.default.options.enable?(t.map((function(t){return t.trim().replace(/[\r\n]/,"")})).filter((function(t){return t.length})).forEach((function(t,n){var a=i.parse(t).contract;if(!(a&&n in r))throw new e.Exception("EINVALIDJSODC","invalid JSDOC. Expected syntax::\n  @param {string|number} ${ foo }\n  @param {number} ${ bar }\n         ");try{e.validate(r[n],a)}catch(t){throw new e.Exception(t.code,"Argument #"+n+": "+t.message)}})),"ignore"):"ignore"}function u(t){return function(r,n,a){var c=a.value,s=i.validateJsDocString(t),u=s.params,f=s.returns;return o.default.options.enable?Object.assign({},a,{value:function(){var t=Array.from(arguments);u.forEach((function(r,a){try{e.validate(t[a],r.contract)}catch(t){throw new e.Exception(t.code,"Method: "+n+", parameter "+r.name+": "+t.message)}}));var r=c.apply(this,t);try{f&&e.validate(r,f.contract)}catch(t){throw new e.Exception(t.code,"Method: "+n+", return value: "+t.message)}return r}}):a}}e.validate=o.default.validate,e.Exception=o.default.Exception,e.typedef=o.default.typedef,e.config=o.default.config,e.validateCombo=o.default.validateCombo,e.is=o.default.is,e.validateContract=s,e.validateJsdoc=u,c.default.byContract=n(n({},o.default),{validateJsdoc:u,validateContract:s})},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=a(r(0)),c=o(r(5)),s=a(r(2));function u(t,e,r){return""+(e?e+": ":"")+(void 0!==r?"Argument #"+r+": ":"")+t}function f(t,e,r){if(!h.options.enable)return t;try{if(void 0===e)throw new i.default("EINVALIDPARAM",u("Invalid validate() parameters. The second parameter (contracts) is missing",r));if(s.default.array(e)&&!s.default.array(t)&&!s.default.arguments(t))throw new i.default("EINVALIDPARAM",u("Invalid validate() parameters. The second parameter (contracts) is array, the first one (values) expected to be array too",r));if(r&&!s.default.string(r))throw new i.default("EINVALIDPARAM",u("Invalid validate() parameters. The third parameter (callContext) shall be string or omitted",r));if(s.default.array(e)){if(s.default.arguments(t)&&(t=Array.from(t)),!s.default.array(t))throw new i.default("EINVALIDPARAM",u("Invalid parameters. When the second parameter (contracts) is an array, the first parameter (values) must an array too",r));return e.forEach((function(e,n){if(!(n in t||e.match(/=$/)))throw new i.default("EMISSINGARG",u("Missing required argument",r));l(t[n],e,r,n)})),t}l(t,e,r)}catch(t){throw t instanceof i.default&&Error.captureStackTrace&&Error.captureStackTrace(t,f),t}return t}function l(t,e,r,n){try{c.default(t,e)}catch(t){if(!(t instanceof i.default))throw t;throw new i.default(t.code,u(t.message,r,n))}}var h={options:{enable:!0},Exception:i.default,validate:f,typedef:function(t,e){if(f([t,e],["string","*"],"byContract.typedef"),t in s.default)throw new i.default("EINVALIDPARAM","Custom type must not override a primitive");c.customTypes[t]=e},config:function(t){h.options=n(n({},h.options),t)},validateCombo:function t(e,r,n){try{if(!s.default.array(e))throw new i.default("EINVALIDPARAM",u("Invalid validateCombo() parameters. The first parameter (values) shall be an array",n));if(!s.default.array(r))throw new i.default("EINVALIDPARAM",u("Invalid validateCombo() parameters. The second parameter (combo) shall be an array",n));var a=r.map((function(t){return function(t,e,r){try{return f(t,e,r),!1}catch(t){return t}}(e,t,n)}));if(a.every((function(t){return!1!==t})))throw a.find((function(t){return!1!==t}))}catch(e){throw e instanceof i.default&&Error.captureStackTrace&&Error.captureStackTrace(e,t),e}return e},is:s.default};e.default=h},function(t,e,r){"use strict";(function(t){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(r(0)),o=n(r(2)),i="undefined"!=typeof window?window:t;function c(t){return"object"==typeof t&&"constructor"in t&&t.constructor.name?"instance of "+t.constructor.name:"function"==typeof t?t.prototype.constructor.name:s(t)}function s(t){return Object.keys(o.default).find((function(e){return o.default[e](t)}))||typeof t}function u(t,e,r){void 0===r&&(r=""),new l(t,e,r).validate()}function f(t,e){return e?e+"."+t:t}e.customTypes={},e.default=u;var l=function(){function t(t,e,r){void 0===r&&(r=""),this.val=t,this.contract=e,this.propPath=r}return t.prototype.validate=function(){if(!this.assertAny()&&!this.assertObject()&&!this.assertInterface()){if(!o.default.string(this.contract))throw this.newException("EINVALIDCONTRACT","invalid parameters. Contract must be a string or a constructor function");if(!this.assertOptional()&&!this.assertBasicType()&&!this.assertNullable()){if(this.assertUnion())return!0;if(this.assertStrictArrayJson())return!0;if(!this.assertStrictArray()&&!this.assertStrictObject()&&!this.assertCustom()){if(!this.contract.match(/^[a-zA-Z0-9\._]+$/))throw this.newException("EINVALIDCONTRACT","invalid contract "+JSON.stringify(this.contract));if(!this.assertGlobal())throw this.newException("EINVALIDCONTRACT","invalid contract "+JSON.stringify(this.contract))}}}},t.prototype.assertCustom=function(){if(!(this.contract in e.customTypes))return!1;try{u(this.val,e.customTypes[this.contract])}catch(t){throw this.newException("EINVALIDTYPE","type "+this.contract+": "+t.message)}return!0},t.prototype.assertGlobal=function(){if(!(this.contract in i)||"function"!=typeof i[this.contract])return!1;if(this.val instanceof i[this.contract])return!0;throw this.newException("EINTERFACEVIOLATION","expected instance of "+i[this.contract]+" but got "+c(this.val))},t.prototype.assertAny=function(){return!(!o.default.string(this.contract)||"*"!==this.contract)},t.prototype.assertObject=function(){var t=this;if(!this.contract||"object"!=typeof this.contract)return!1;if(!this.val||"object"!=typeof this.val)throw this.newException("EINVALIDTYPE","expected object literal but got "+s(this.val));return Object.keys(this.contract).forEach((function(e,r){var n=t.contract[e];if(!(e in t.val||function(t){return o.default.string(t)&&t.endsWith("=")}(n)))throw t.newException("EMISSINGPROP","missing required property #"+f(e,t.propPath));u(t.val[e],n,f(e,t.propPath))})),!0},t.prototype.assertInterface=function(){if(!o.default.function(this.contract)&&"object"!=typeof this.contract)return!1;if(!(this.val instanceof this.contract))throw this.newException("EINTERFACEVIOLATION","expected instance of "+c(this.contract)+" but got "+c(this.val));return!0},t.prototype.assertOptional=function(){if(this.contract.match(/=$/)){if(!this.val)return!0;this.contract=this.contract.substr(0,this.contract.length-1)}return!1},t.prototype.assertBasicType=function(){var t=this.contract.toLowerCase(),e=o.default[t];if(void 0===e)return!1;if(!e(this.val))throw this.newException("EINVALIDTYPE","expected "+t+" but got "+s(this.val));return!0},t.prototype.assertNullable=function(){if(!this.contract.startsWith("?"))return!1;var t=this.contract.replace(/^\?/,"").toLowerCase(),e=o.default[t];if(o.default.null(this.val))return!0;if(void 0===e)throw this.newException("EINVALIDCONTRACT","invalid contract "+JSON.stringify(t));if(!e(this.val))throw this.newException("EINVALIDTYPE","expected "+this.contract+" but got "+s(this.val));return!0},t.prototype.assertUnion=function(){var t=this;if(!this.contract.includes("|"))return!1;var e=[];if(!this.contract.split("|").some((function(r){return function(t,e,r){void 0===r&&(r=[]);try{return u(t,e),!0}catch(t){if(!(t instanceof a.default))throw t;return r.push(t.message),!1}}(t.val,r,e)}))){var r=o.default.array(this.val)||o.default.object(this.val)?"failed on each: "+e.join(", "):"got "+s(this.val);throw this.newException("EINVALIDTYPE","expected "+this.contract+" but "+r)}return!0},t.prototype.assertStrictArrayJson=function(){if(!this.contract.endsWith("[]"))return!1;if(!o.default.array(this.val))return this.contract="array",this.assertBasicType();var t=this.contract.replace(/\[\]$/,""),e=0;if("*"===t)return this.contract="array",this.assertBasicType();try{o.default.array(this.val)&&this.val.forEach((function(r){u(r,t),e++}))}catch(t){throw this.newException("EINVALIDTYPE","array element "+e+": "+t.message)}return!0},t.prototype.assertStrictArray=function(){if(!this.contract.startsWith("Array.<"))return!1;if(!o.default.array(this.val))return this.contract="array",this.assertBasicType();var t=0,e=this.contract.match(/Array\.<(.+)>/i);if(!e)throw this.newException("EINVALIDCONTRACT","invalid contract "+c(this.contract));if("*"===e[1])return this.contract="array",this.assertBasicType();try{o.default.array(this.val)&&this.val.forEach((function(r){u(r,e[1]),t++}))}catch(e){throw this.newException("EINVALIDTYPE","array element "+t+": "+e.message)}return!0},t.prototype.assertStrictObject=function(){var t=this;if(0!==this.contract.indexOf("Object.<"))return!1;if(!o.default.object(this.val))return this.contract="object",this.assertBasicType();var e=null,r=this.contract.match(/Object\.<(.+),\s*(.+)>/i);if(!r)throw this.newException("EINVALIDCONTRACT","invalid contract "+c(this.contract));if("*"===r[2])return this.contract="object",this.assertBasicType();try{o.default.object(this.val)&&Object.keys(this.val).forEach((function(n){e=n,u(t.val[n],r[2])}))}catch(t){throw this.newException("EINVALIDTYPE","object property "+e+": "+t.message)}return!0},t.prototype.newException=function(t,e){var r=this.propPath?"property #"+this.propPath+" ":"";return new a.default(t,r+e)},t}()}).call(this,r(1))},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(r(0));function o(t){var e=t.indexOf("{"),r=t.indexOf("}");if(-1===e||-1===r)throw new a.default("EINVALIDJSDOC","invalid JSDOC. Expected syntax: { exp } param got "+t);return{contract:t.substr(e+1,r-e-1),name:t.substr(r+1).trim()}}e.parse=o,e.validateJsDocString=function(t){var e=[],r=null;return t.split("\n").map((function(t){return t.trim().replace(/\r/,"")})).filter((function(t){return t.length})).forEach((function(t){switch(!0){case t.startsWith("@param"):e.push(o(t));break;case t.startsWith("@returns"):r=o(t);break;default:throw new a.default("EINVALIDJSDOC","only @param and @returns tags allowed")}})),{params:e,returns:r}}},function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r="undefined"!=typeof window?window:t;e.default=r}).call(this,r(1))}])}));